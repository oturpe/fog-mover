projectName=fog-mover
sourceDir=src
#libDir=src/lib/DmxSimple
targetDir=target
mcu=attiny2313
#programmer=arduinoisp
programmer=avrisp

if [ ! -e ${targetDir} ]; then
  mkdir ${targetDir}
fi

avr-gcc -Os -mmcu=${mcu} -o ${targetDir}/${projectName}.out ${sourceDir}/*.cpp
if [ $? -ne 0 ]; then
  echo "Build failed"
  exit 0
fi

avr-objcopy -j .text -j .data -O ihex ${targetDir}/${projectName}.out ${targetDir}/${projectName}.hex
if [ -$? -ne 0 ]; then
  echo "Hex file generation failed"
  exit 0
fi

sudo avrdude -c ${programmer} -b 19200 -p ${mcu} -P /dev/ttyACM0 -U flash:w:${targetDir}/${projectName}.hex
if [ $? -ne 0 ]; then
  echo "Upload failed"
  exit 0
fi
